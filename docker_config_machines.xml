<?xml version="1.0" encoding="utf-8"?>
<config_machines  version="2.0">
    <machine MACH="container">
        <DESC>For use in containerized CESM.</DESC>
        <NODENAME_REGEX>__hostname__</NODENAME_REGEX>
        <OS>LINUX</OS>
        <COMPILERS>gnu</COMPILERS>
        <MPILIBS>mvapich</MPILIBS>
        <PROJECT>none</PROJECT>
        <CIME_OUTPUT_ROOT>$ENV{CIME_OUTPUT_ROOT}</CIME_OUTPUT_ROOT>
        <DIN_LOC_ROOT>$ENV{DIN_LOC_ROOT}</DIN_LOC_ROOT>
        <DOUT_S_ROOT>$ENV{DOUT_S_ROOT}</DOUT_S_ROOT>
        <BASELINE_ROOT>$ENV{BASELINE_ROOT}</BASELINE_ROOT>
        <BATCH_SYSTEM>none</BATCH_SYSTEM>
        <SUPPORTED_BY>Cameron Cummins</SUPPORTED_BY>
        <MAX_TASKS_PER_NODE>4</MAX_TASKS_PER_NODE>
        <MAX_MPITASKS_PER_NODE>4</MAX_MPITASKS_PER_NODE>
        <mpirun mpilib="mvapich">
            <executable>mpirun</executable>
            <arguments>
                <arg name="num_tasks"> -np {{ total_tasks }}</arg>
            </arguments>
        </mpirun>
        <module_system type="none"/>
    </machine>
    <machine MACH="ls6">
        <DESC>Ls6 cluster at TACC, OS is Linux (intel), batch system is SLURM</DESC>
        <NODENAME_REGEX>.*ls6\.tacc\.utexas\.edu</NODENAME_REGEX>
        <OS>LINUX</OS>
        <COMPILERS>gnu</COMPILERS>
        <MPILIBS>mvapich</MPILIBS>
        <CIME_OUTPUT_ROOT>$ENV{CIME_OUTPUT_ROOT}</CIME_OUTPUT_ROOT>
        <DIN_LOC_ROOT>$ENV{DIN_LOC_ROOT}</DIN_LOC_ROOT>
        <DOUT_S_ROOT>$ENV{DOUT_S_ROOT}</DOUT_S_ROOT>
        <BASELINE_ROOT>$ENV{BASELINE_ROOT}</BASELINE_ROOT>
        <GMAKE_J>32</GMAKE_J>
        <BATCH_SYSTEM>slurm</BATCH_SYSTEM>
        <SUPPORTED_BY>cseg</SUPPORTED_BY>
        <MAX_TASKS_PER_NODE>128</MAX_TASKS_PER_NODE>
        <MAX_MPITASKS_PER_NODE>128</MAX_MPITASKS_PER_NODE>
        <PROJECT_REQUIRED>TRUE</PROJECT_REQUIRED>
        <mpirun mpilib="default">
          <executable>sbcast ${EXEROOT}/cesm.exe /tmp/cesm.exe; ibrun -n ${TOTALPES} /work/07644/oxygen/ls6/run_wrapper.sh</executable>
        </mpirun>
        <module_system type="none"/>
        <environment_variables>
          <env name="MV2_SMP_USE_CMA">0</env>
          <env name="CONTAINER_IMAGE">/work/07644/oxygen/ls6/cesm2.1.5.sif</env>
        </environment_variables>
    </machine>
</config_machines>
